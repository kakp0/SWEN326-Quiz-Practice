/* Basic Reset & Font */
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Roboto', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    color: #e0e0e0; /* Light text color */
    padding: 20px; /* Add some padding around the container */

    /* --- Updated Black Background & Caustics Effect --- */
    background-color: #080808; /* Near black base */
    background-image:
        /* Layer 1: Slightly more pronounced ripples */
        radial-gradient(ellipse at center, rgba(200, 200, 200, 0.12) 0%, rgba(200, 200, 200, 0) 70%),
        /* Layer 2: Fainter, larger ripples */
        radial-gradient(ellipse at center, rgba(220, 220, 220, 0.1) 0%, rgba(220, 220, 220, 0) 65%),
        /* Layer 3: Base dark gradient */
        linear-gradient(135deg, #111 0%, #000 100%);
    background-size:
        150% 150%, /* Ripple 1 */
        200% 200%, /* Ripple 2 */
        100% 100%; /* Base */
    background-position:
        0% 0%,    /* Ripple 1 */
        50% 50%,  /* Ripple 2 */
        0% 0%;    /* Base */
    /* Faster and more varied animation */
    animation: causticsShift 30s linear infinite alternate; /* Reduced duration */
    /* --- End Background Effect --- */

    overflow: hidden; /* Prevent scrollbars on the body */
}

/* Keyframes for more pronounced caustics animation */
@keyframes causticsShift {
    0% { background-position: 0% 0%, 50% 50%, 0% 0%; }
    25% { background-position: 40% 50%, 80% 30%, 0% 0%; }
    50% { background-position: 20% 80%, 30% 60%, 0% 0%; }
    75% { background-position: 60% 10%, 10% 40%, 0% 0%; }
    100% { background-position: 0% 50%, 50% 0%, 0% 0%; }
}

/* Quiz Container */
.quiz-container {
    background-color: rgba(30, 30, 30, 0.9);
    border: 1px solid #333;
    border-radius: 15px;
    padding: 30px 40px; /* Base padding, will be scaled below */
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
    width: 100%;
    max-width: 700px;
    text-align: center;
    position: relative;
    z-index: 1;
    /* Ensure max-height has a transition */
    transition: max-height 0.4s ease-in-out, min-height 0.4s ease-in-out, padding 0.3s ease-out;
    overflow: hidden; /* Prevent container scrollbars */
    max-height: 95vh; /* Initial large max-height */
    min-height: 300px; /* ADJUST IF NEEDED: A stable minimum height */
    /* --- ADDED: Define a CSS variable for font scaling --- */
    --font-scale-factor: 1; /* Default scale is 1 */
    /* Apply scaling to padding using the variable */
    padding: calc(30px * var(--font-scale-factor)) calc(40px * var(--font-scale-factor));
}

/* Add a class for the shrinking state (if still used for animation) */
.quiz-container.shrinking {
    max-height: 70px;
    min-height: 70px !important;
}


/* Screen Management & Basic Fade */
.screen {
    display: none;
    animation: fadeIn 0.5s ease-out forwards;
}
.screen.active {
    display: block;
}
.screen.fade-out {
    animation: fadeOut 0.4s ease-in forwards;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeOut {
    from { opacity: 1; transform: translateY(0); }
    to   { opacity: 0; transform: translateY(-15px); }
}

/* Q/A Container */
.q-a-container {
    opacity: 1;
    transform: translateX(0);
    padding-bottom: 10px; /* Space for next button */
    /* Removed height transition from here */
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
}


/* Apply scaling to text elements using the variable & add transitions */

h1 { /* Applies to start/end screens */
    color: #ffffff;
    font-size: calc(2.2em * var(--font-scale-factor));
    margin-bottom: calc(15px * var(--font-scale-factor));
    transition: font-size 0.3s ease-out, margin-bottom 0.3s ease-out;
}

/* --- High Score Area Styling --- */
#high-scores-area {
    margin-top: calc(30px * var(--font-scale-factor));
    padding-top: calc(15px * var(--font-scale-factor));
    border-top: 1px solid #444;
    text-align: left;
}

#high-scores-area h2 {
    color: #bbb;
    font-size: calc(1.3em * var(--font-scale-factor));
    margin-bottom: calc(15px * var(--font-scale-factor));
    text-align: center;
}

.high-score-entry {
    display: flex;
    align-items: center;
    justify-content: space-between; /* Distribute space */
    padding: calc(8px * var(--font-scale-factor)) 0;
    margin-bottom: calc(5px * var(--font-scale-factor));
    font-size: calc(1em * var(--font-scale-factor));
    color: #ccc;
    flex-wrap: wrap; /* Allow wrapping on small screens if needed */
}

.high-score-entry span:first-child { /* Label (e.g., "Full Test:") */
    flex-basis: 120px; /* Give label some fixed space */
    flex-grow: 0;
    flex-shrink: 0;
    font-weight: bold;
    color: #ddd;
}

.high-score-entry .score-text {
    flex-basis: 80px; /* Space for score like "18/25" */
    text-align: right;
    color: #fff;
    font-weight: bold;
}

.high-score-entry .grade-text {
    flex-basis: 40px; /* Space for grade like "A+" */
    text-align: center;
    color: #fff;
    font-weight: bold;
}

.stars-container {
    display: inline-flex; /* Use inline-flex for stars */
    align-items: center;
    margin-left: calc(10px * var(--font-scale-factor)); /* Space before stars */
    flex-basis: 80px; /* Fixed width for 3 stars */
    height: calc(20px * var(--font-scale-factor)); /* Star height */
    background: linear-gradient(to right, gold var(--star-fill-percentage, 0%), rgba(255, 255, 255, 0.2) var(--star-fill-percentage, 0%));
    clip-path: url(#starClip); /* Apply the star shape mask */
    -webkit-clip-path: url(#starClip); /* Safari */
}

/* Define the star shape in SVG (can be hidden in HTML or here) */
/* You'll need to add the SVG to your HTML for this clip-path to work reliably */
/* Example SVG (add this within your <body> or a hidden div in index.html):
<svg width="0" height="0">
  <defs>
    <clipPath id="starClip" clipPathUnits="objectBoundingBox">
       <path d="M0.5,0 L0.61,0.35 L0.98,0.35 L0.68,0.57 L0.79,0.91 L0.5,0.69 L0.21,0.91 L0.32,0.57 L0.02,0.35 L0.39,0.35 Z"/>
     </clipPath>
  </defs>
</svg>
*/

/* Alternative Star Styling (Simpler using text characters) - Uncomment if SVG clip-path is problematic */
/*
.stars-container {
    display: inline-block;
    position: relative;
    font-size: calc(1.5em * var(--font-scale-factor)); /* Adjust size */
/* line-height: 1;
    color: rgba(255, 255, 255, 0.2); /* Empty star color */
/* }

.stars-container::before {
    content: '★★★'; /* Three empty stars */
/* }

.stars-container::after {
    content: '★★★'; /* Three filled stars */
/* position: absolute;
    top: 0;
    left: 0;
    color: gold;
    overflow: hidden;
    width: var(--star-fill-percentage, 0%); /* Control fill */
/* white-space: nowrap;
}*/
/* --- End High Score Area Styling --- */


p { /* Base paragraph styling */
    color: #ccc;
    font-size: calc(1.1em * var(--font-scale-factor));
    margin-bottom: calc(25px * var(--font-scale-factor));
    transition: font-size 0.3s ease-out, margin-bottom 0.3s ease-out;
}

#result-text { /* Specific style for result */
    font-size: calc(1.3em * var(--font-scale-factor));
    font-weight: bold;
    color: #ffffff;
    margin-bottom: calc(30px * var(--font-scale-factor));
    /* Inherits transition from p or add specific if needed */
}

h2#question-text {
    color: #f5f5f5;
    font-size: calc(1.4em * var(--font-scale-factor));
    line-height: 1.5; /* Keep line-height relative */
    min-height: calc(60px * var(--font-scale-factor)); /* Scale min-height */
    margin-bottom: calc(25px * var(--font-scale-factor)); /* Scale margin */
    text-align: left;
    transition: opacity 0.3s ease-in-out, font-size 0.3s ease-out, min-height 0.3s ease-out, margin-bottom 0.3s ease-out; /* Added font-size etc. transitions */
}
h2#question-text.text-fade-out {
    opacity: 0;
}
h2#question-text.text-fade-in {
    opacity: 1;
}

/* Vertical Button Stack for Answers */
.btn-stack {
    display: flex;
    flex-direction: column;
    gap: calc(12px * var(--font-scale-factor)); /* Scale gap */
    margin-top: calc(20px * var(--font-scale-factor)); /* Scale margin */
    transition: opacity 0.3s ease-out, gap 0.3s ease-out, margin-top 0.3s ease-out; /* Added gap/margin transitions */
}

/* General Button Styling (Used for Answer Choices) */
.btn {
    background-color: #333;
    color: #f0f0f0;
    border: 1px solid #555;
    border-radius: calc(8px * var(--font-scale-factor)); /* Scale border-radius */
    padding: calc(15px * var(--font-scale-factor)) calc(25px * var(--font-scale-factor)); /* Scale padding */
    font-size: calc(1.1em * var(--font-scale-factor)); /* Scale font size */
    cursor: pointer;
    text-align: left;
    width: 100%;
    box-shadow: none;
    /* Added font-size/padding/border-radius transitions */
    transition: background-color 0.3s ease, transform 0.2s ease, border-color 0.3s ease, font-size 0.3s ease-out, padding 0.3s ease-out, border-radius 0.3s ease-out;
}
.btn:hover:not(.disabled):not(.correct):not(.incorrect) {
    background-color: #444;
    border-color: #777;
    transform: translateY(-2px);
}
.btn:active:not(.disabled) {
    transform: translateY(0);
}

/* Modified Disabled Style for General Buttons (Answer Choices) */
/* Only make buttons non-clickable, don't change visual appearance */
.btn.disabled {
    pointer-events: none;
    /* opacity: 0.65; REMOVED */
    cursor: default;
}

/* Specific Buttons (Start, Retry) - ORIGINAL Blue style REMOVED */
#start-btn, #retry-btn { /* This rule might be redundant now, but kept for structure */
    display: inline-block;
    width: auto;
    /* Use calc for padding, inheriting other scaled properties */
    padding: calc(15px * var(--font-scale-factor)) calc(40px * var(--font-scale-factor));
    text-align: center;
    margin-top: calc(20px * var(--font-scale-factor));
    /* background-color: #007bff; REMOVED */
    /* border-color: #0056b3; REMOVED */
    /* color: white; REMOVED */
}

/* Next Button Specific Styling & Animation - ORIGINAL Blue Style REMOVED */
.next-btn { /* Base class still used for layout/visibility */
    display: inline-block;
    width: auto;
    /* Use calc for padding/margins, inheriting other scaled properties */
    padding: calc(15px * var(--font-scale-factor)) calc(40px * var(--font-scale-factor));
    text-align: center;
    /* background-color: #007bff; REMOVED */
    /* border-color: #0056b3; REMOVED */
    /* color: white; REMOVED */
    cursor: pointer;
    overflow: hidden;
    margin-top: calc(20px * var(--font-scale-factor));
    margin-bottom: calc(10px * var(--font-scale-factor));
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    /* Keep opacity/visibility transition, others handled by new unified style */
    transition: opacity 0.4s ease-out, visibility 0.4s step-end, margin-top 0.3s ease-out, margin-bottom 0.3s ease-out;
}

/* --- New Unified Button Styles (Bone White) --- */
#start-full-btn,
#start-2025-btn,
#start-2024-btn,
#retry-btn,
#back-to-start-btn,
#next-btn { /* Target #next-btn ID directly */
    background-color: #F9F6EE; /* Bone white */
    color: #333; /* Darker text */
    border: 1px solid #DCDCDC; /* Light grey border */
    padding: calc(12px * var(--font-scale-factor)) calc(30px * var(--font-scale-factor)); /* Adjusted padding */
    text-align: center; /* Ensure text is centered */
    font-weight: bold; /* Make text slightly bolder */
    font-size: calc(1.05em * var(--font-scale-factor)); /* Slightly larger font */
    border-radius: calc(6px * var(--font-scale-factor)); /* Slightly softer corners */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow */
    transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, border-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out, opacity 0.4s ease-out, visibility 0.4s step-end; /* Smooth transitions INCLUDING visibility/opacity for next */
    display: inline-block; /* Ensure proper layout */
    width: auto; /* Override potential 100% width from .btn */
    margin-top: calc(10px * var(--font-scale-factor)); /* Adjust vertical spacing */
    margin-left: calc(5px * var(--font-scale-factor)); /* Add some horizontal space between buttons */
    margin-right: calc(5px * var(--font-scale-factor));
    cursor: pointer; /* Ensure cursor is pointer */
    /* Override any specific blue styles */
    border-color: #DCDCDC; /* Ensure border is not blue */
}

/* --- Hover State (Bone White) --- */
#start-full-btn:hover:not(.disabled),
#start-2025-btn:hover:not(.disabled),
#start-2024-btn:hover:not(.disabled),
#retry-btn:hover:not(.disabled),
#back-to-start-btn:hover:not(.disabled),
#next-btn:hover:not(.disabled) {
    background-color: #E8E4D9; /* Slightly darker bone white */
    border-color: #C0C0C0; /* Slightly darker grey border */
    color: #111; /* Darker text on hover */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); /* Enhanced shadow */
    transform: translateY(-1px); /* Slight lift */
}

/* --- Active State (Bone White) --- */
#start-full-btn:active:not(.disabled),
#start-2025-btn:active:not(.disabled),
#start-2024-btn:active:not(.disabled),
#retry-btn:active:not(.disabled),
#back-to-start-btn:active:not(.disabled),
#next-btn:active:not(.disabled) {
    background-color: #DCDCDC; /* Even darker shade */
    border-color: #A9A9A9; /* Darker border */
    transform: translateY(0px); /* Press down */
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); /* Reduced shadow */
}

/* --- Disabled State (Bone White) --- */
/* This provides the light grey disabled look specifically for these buttons */
#start-full-btn.disabled,
#start-2025-btn.disabled,
#start-2024-btn.disabled,
#retry-btn.disabled,
#back-to-start-btn.disabled,
#next-btn.disabled {
     background-color: #EAEAEA !important;
     color: #999 !important;
     border-color: #DCDCDC !important;
     box-shadow: none !important;
     transform: none !important;
     pointer-events: none; /* Ensure non-clickable */
     cursor: default;
     opacity: 0.65 !important; /* Add opacity specifically for these disabled buttons */
}


/* --- Next Button Visibility --- */
/* Inherits base style from unified rule above */
/* Ensure visibility transitions correctly */
#next-btn {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}

#next-btn.visible {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    /* Transitions handled by unified style, but adjust visibility timing if needed */
    transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, border-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out, opacity 0.4s ease-out, visibility 0s; /* Adjust visibility timing */
}


/* --- Button Feedback Styles & Animations (Answer Choices) --- */
/* Ensure these override base .btn styles */
.btn.correct {
    background-color: #28a745 !important;
    border-color: #1e7e34 !important;
    color: white !important;
    animation: pulse 0.5s;
    opacity: 1 !important; /* Ensure full opacity */
}
.btn.incorrect {
    background-color: #dc3545 !important;
    border-color: #bd2130 !important;
    color: white !important;
    animation: shake 0.5s;
    opacity: 1 !important; /* Ensure full opacity */
}


/* Pulse & Shake Keyframes (remain the same) */
@keyframes pulse {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.03); }
    100% { transform: scale(1); }
}
@keyframes shake {
    0%,100% { transform: translateX(0); }
    25%     { transform: translateX(-5px); }
    50%     { transform: translateX(5px); }
    75%     { transform: translateX(-5px); }
}

#hud {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    /* Scale base font size, margins, padding, min-height */
    font-size: calc(1em * var(--font-scale-factor));
    margin-bottom: calc(20px * var(--font-scale-factor));
    padding-left: calc(10px * var(--font-scale-factor));
    padding-right: calc(10px * var(--font-scale-factor));
    min-height: calc(1.5em * var(--font-scale-factor));
    color: #aaa;
    transition: font-size 0.3s ease-out, margin-bottom 0.3s ease-out, padding 0.3s ease-out, min-height 0.3s ease-out; /* Add transitions */
}

#hud p {
    margin-bottom: 0;
    padding-top: calc(2px * var(--font-scale-factor));
    padding-bottom: calc(2px * var(--font-scale-factor));
    line-height: 1.2; /* Relative line height might not need scaling */
    font-size: inherit; /* Inherit scaled size from #hud */
    transition: padding 0.3s ease-out; /* Add padding transition */
}

#feedback-text {
    font-weight: bold;
    font-size: calc(1.1em * var(--font-scale-factor)); /* Scale feedback text size */
    text-align: right;
    transition: opacity 0.3s ease-in-out, font-size 0.3s ease-out; /* Added font-size transition */
}
#feedback-text.correct { color: #2ecc71; }
#feedback-text.incorrect { color: #e74c3c; }

/* Utility Class */
.hidden { display: none !important; }

/* --- Results List Styling --- */
.results-list {
    margin-top: calc(20px * var(--font-scale-factor)); /* Scale margin */
    max-height: calc(300px * var(--font-scale-factor)); /* Set a max height for scrollability */
    overflow-y: auto; /* Enable vertical scrolling */
    text-align: left; /* Align text left within the list */
    padding-right: calc(10px * var(--font-scale-factor)); /* Add padding for scrollbar */
    /* Style the scrollbar */
    scrollbar-width: thin;
    scrollbar-color: #555 #333;
    transition: max-height 0.4s ease-in-out, margin-top 0.3s ease-out, padding-right 0.3s ease-out; /* Add transitions */
}

/* Style for individual result items */
.result-item {
    background-color: rgba(40, 40, 40, 0.8);
    border: 1px solid #444;
    border-radius: calc(8px * var(--font-scale-factor)); /* Scale border-radius */
    padding: calc(15px * var(--font-scale-factor)); /* Scale padding */
    margin-bottom: calc(15px * var(--font-scale-factor)); /* Scale margin */
    transition: padding 0.3s ease-out, margin-bottom 0.3s ease-out, border-radius 0.3s ease-out; /* Add transitions */
}

.result-item strong {
    color: #f5f5f5;
    font-size: calc(1.1em * var(--font-scale-factor)); /* Scale font size */
    display: block; /* Make question text a block */
    margin-bottom: calc(8px * var(--font-scale-factor)); /* Space below question */
    transition: font-size 0.3s ease-out, margin-bottom 0.3s ease-out; /* Add transitions */
}

.result-item p {
    font-size: calc(1em * var(--font-scale-factor)); /* Scale font size */
    margin-bottom: calc(5px * var(--font-scale-factor)); /* Space between answer lines */
    color: #ccc;
    transition: font-size 0.3s ease-out, margin-bottom 0.3s ease-out; /* Add transitions */
}

.result-item .correct-answer {
    color: #28a745; /* Green for correct answer */
    font-weight: bold;
}

.result-item .user-answer {
    font-style: italic;
}

.result-item .user-answer.incorrect {
    color: #dc3545; /* Red for incorrect user answer */
    font-weight: bold;
}

/* Custom scrollbar styles for Webkit browsers */
.results-list::-webkit-scrollbar {
    width: 8px;
}

.results-list::-webkit-scrollbar-track {
    background: #333;
    border-radius: 10px;
}

.results-list::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 10px;
}

.results-list::-webkit-scrollbar-thumb:hover {
    background: #777;
}


/* --- Optional: Adjust Start Screen Button Layout --- */
/* This makes the initial three buttons wider and centered */
#start-screen .btn-stack .btn { /* Make this specific to start screen buttons */
     width: 80%; /* Make start buttons wider */
     max-width: 350px; /* Add a max-width */
     margin-left: auto;
     margin-right: auto;
     display: block; /* Stack them vertically cleanly */
     margin-bottom: calc(15px * var(--font-scale-factor)); /* Space between start buttons */
     margin-top: 0; /* Reset top margin if needed */
     text-align: center; /* Ensure text is centered */
     /* These will inherit the bone-white style from the ID selectors */
}


/* Responsive Adjustments */
@media (max-width: 600px) {
    /* Container padding is now handled by the main rule with calc() */
    .quiz-container {
         /* Adjust base min/max height if needed for small screens */
         /* max-height: 98vh; */
         /* min-height: 250px; */
    }

    /* Optionally adjust base font sizes *before* scaling if needed */
    /* Example: Make base question text slightly smaller on mobile */
    /* h2#question-text {
        font-size: calc(1.2em * var(--font-scale-factor));
        min-height: calc(50px * var(--font-scale-factor));
    } */
    /* Example: Make base button text/padding slightly smaller on mobile */
    /* .btn {
        font-size: calc(1em * var(--font-scale-factor));
        padding: calc(12px * var(--font-scale-factor)) calc(15px * var(--font-scale-factor));
    } */

    /* Adjust unified button padding base on mobile */
    #start-full-btn,
    #start-2025-btn,
    #start-2024-btn,
    #retry-btn,
    #back-to-start-btn,
    #next-btn {
        padding: calc(10px * var(--font-scale-factor)) calc(20px * var(--font-scale-factor));
    }

    /* Adjust High Score display on smaller screens */
    .high-score-entry {
        font-size: calc(0.9em * var(--font-scale-factor)); /* Slightly smaller text */
        flex-direction: column; /* Stack elements vertically */
        align-items: flex-start; /* Align items to the left */
        border-bottom: 1px dashed #444;
        padding-bottom: calc(8px * var(--font-scale-factor));
    }
    .high-score-entry:last-child {
        border-bottom: none;
    }
     .high-score-entry span, .high-score-entry .stars-container {
        flex-basis: auto; /* Reset basis */
        width: 100%; /* Take full width */
        text-align: left; /* Align text left */
        margin-left: 0; /* Reset margin */
        margin-bottom: calc(3px * var(--font-scale-factor)); /* Add spacing */
    }
     .high-score-entry .score-text, .high-score-entry .grade-text {
        text-align: left; /* Align left */
        display: inline-block; /* Allow side-by-side */
        width: auto; /* Adjust width */
        margin-right: calc(10px * var(--font-scale-factor)); /* Space between score and grade */
    }
    .high-score-entry .stars-container {
         margin-top: calc(5px * var(--font-scale-factor)); /* Space above stars */
    }

    /* Adjust HUD padding base values for small screens */
    /* #hud {
        padding-left: calc(5px * var(--font-scale-factor));
        padding-right: calc(5px * var(--font-scale-factor));
    } */
}
